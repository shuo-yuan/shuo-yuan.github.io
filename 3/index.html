<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 3: [Auto]Stitching Photo Mosaics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .part {
            background: white;
            margin: 20px 0;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .part h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        
        .gif-container {
            text-align: center;
        }
        
        .gif-container img {
            max-width: 60%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .gif-container p {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
        
        .selfie-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin: 30px 0 20px 0;
            flex-wrap: nowrap;
            padding: 0 10px;
        }
        
        .code-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 30px 0 20px 0;
        }
        
        .part2 .selfie-row {
            gap: 80px;
        }
        
        .selfie-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 1;
            min-width: 0;
        }
        
        .selfie-row img {
            max-width: 200px;
            max-height: 200px;
            width: auto;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            object-fit: cover;
            margin-bottom: 8px;
        }
        
        .part2 .selfie-row img {
            max-width: 500px;
            max-height: 500px;
        }
        
        .selfie-caption {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            margin-top: 4px;
        }
        
        .code-block {
            width: 100%;
            max-width: 1000px;
            margin: 0;
        }
        
        .code-block pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 0;
            overflow: hidden;
            font-size: 11px;
            line-height: 1.4;
            height: auto;
        }
        
        .code-block code {
            text-align: left;
            display: block;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
        }
        
        .code-caption {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            margin-top: 8px;
            text-align: center;
        }
        
        .runtime-table {
            margin: 30px auto;
            border-collapse: collapse;
            width: 90%;
            max-width: 900px;
        }
        
        .runtime-table th, .runtime-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
            width: 25%;
        }
        
        .runtime-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .table-caption {
            font-size: 14px;
            color: #666;
            font-weight: 500;
            margin-top: 5px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        /* Hybrid Images Layout Styles */
        .hybrid-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            margin: 30px auto 50px auto;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            background-color: #fafafa;
            max-width: 1000px;
        }
        
        .hybrid-left {
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex: 1;
            max-width: 450px;
        }
        
        .hybrid-row {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .hybrid-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .hybrid-right {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 0 0 auto;
            justify-content: center;
        }
        
        .hybrid-right img {
            border: 2px solid #333;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        
        /* Fix white space issues in hybrid containers */
        .hybrid-container img {
            display: block;
            object-fit: cover;
            object-position: center;
        }
        
        .hybrid-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            height: 100%;
        }
        
        .hybrid-right {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 0 0 auto;
            justify-content: center;
            height: 100%;
        }
        
        .part2 h3 {
            color: #444;
            font-size: 20px;
            margin-top: 40px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        /* Specific styling for spectrum images */
        .hybrid-container .hybrid-left .hybrid-row {
            gap: 60px;
        }
        
        .hybrid-container .hybrid-left {
            gap: 60px;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center; color: #333; margin-bottom: 40px;">Project 3: [Auto]Stitching Photo Mosaics</h1>
    
    <div class="part overview">
        <h2>Project Overview</h2>
        <p style="text-align: justify;">This project implements the automatic stitching of photo mosaics. For part A, the stitching is done by manually picking correspondence points between the images and using a homography matrix to project the images on the same plane.</p>
    </div>

    <div class="part part1">
        <h2>Part A.1: Shoot the Pictures</h2>
        <p style="text-align: justify;">This part includes sets of pictures shot with projective transformations, ie. rotating the camera while keeping the COP (center of projection) the same. Later part of the project will be done with these pictures.</p>
        
        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a1/lecture_1.jpg" alt="Original Selfie" style="max-width: 320px; max-height: 320px;">
                <div class="selfie-caption">During Lecture (left)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a1/lecture_2.jpg" alt="Box Filter Result" style="max-width: 320px; max-height: 320px;">
                <div class="selfie-caption">During Lecture (middle)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a1/lecture_3.jpg" alt="Gradient Dx Result" style="max-width: 320px; max-height: 320px;">
                <div class="selfie-caption">During Lecture (right)</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a1/soda_1.jpg" alt="Original Selfie" style="max-width: 320px; max-height: 320px;">
                <div class="selfie-caption">Outside Soda (left)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a1/soda_2.jpg" alt="Box Filter Result" style="max-width: 320px; max-height: 320px;">
                <div class="selfie-caption">Outside Soda (middle)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a1/soda_3.jpg" alt="Gradient Dx Result" style="max-width: 320px; max-height: 320px;">
                <div class="selfie-caption">Outside Soda (right)</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a1/sky_1.jpg" alt="Original Selfie" style="max-width: 320px; max-height: 320px;">
                <div class="selfie-caption">Inside Sky Lab (left)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a1/sky_2.jpg" alt="Box Filter Result" style="max-width: 320px; max-height: 320px;">
                <div class="selfie-caption">Inside Sky Lab (middle)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a1/sky_3.jpg" alt="Gradient Dx Result" style="max-width: 320px; max-height: 320px;">
                <div class="selfie-caption">Inside Sky Lab (right)</div>
            </div>
        </div>

        </div>
    
    <div class="part part1">
        <h2>Part A.2: Recover Homographies</h2>
        <p style="text-align: justify;">This part introduces how we can recover the homography matrix with a set of correspondence points. Note that the homography matrix has 8 degrees of freedom, therefore we need at least 4 points to recover a homography matrix. More points are needed for a more robust recovery.</p>


        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a2/homography.png" alt="homography matrix" style="max-width: 700px; max-height: 350px;">
                <div class="selfie-caption">Homography Matrix</div>
            </div>
        </div>
        <p style="text-align: justify;">Since the 1 on the homography matrix is fixed, we cannot directly solve for the homography matrix. Therefore, we need to expand the system of equations and use least squares to solve for the homography matrix.</p>
        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a2/system_of_equations.png" alt="system of equations" style="max-width: 700px; max-height: 350px;">
                <div class="selfie-caption">System of Equations to Recover the Homography matrix</div>
            </div>
        </div>
        <p style="text-align: justify;">An example of manually picked correspondences and the recoevred homography matrix are shown below.</p>
        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a2/lecture_1_correspondence.png" alt="lecture_1_correspondence" style="max-width: 350px; max-height: 350px;">
                <div class="selfie-caption">During Lecture (left) Correspondences</div>
            </div>
            <div class="selfie-item">
                <img src="part_a2/lecture_2_correspondence.png" alt="lecture_2_correspondence" style="max-width: 350px; max-height: 350px;">
                <div class="selfie-caption">During Lecture (middle) Correspondences</div>
            </div>
            <div class="selfie-item">
                <img src="part_a2/recovered_H.png" alt="recovered_H_matrix" style="max-width: 350px; max-height: 350px;">
                <div class="selfie-caption">The Recovered Homography Matrix</div>
            </div>
        </div>
    </div>
    
    <div class="part part1">
        <h2>Part A.3: Warp the Images</h2>
        <p style="text-align: justify;">This part introduces two methods to warp the images after recovering the homography matrix: nearest neighbor and bilinear interpolation. The nearest neighbor method is the simplest method to warp the images, where one only needs to find the pixel values of the nearest pixel in the original image (pixels are got from inverse mapping); he bilinear interpolation method finds the pixel values of the four nearest pixels in the original image and uses a weighted average to find the pixel values of the warped image. Here are some examples of the warped images (rectification) with both methods.</p>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a3/channing_court.jpg" alt="channing_court" style="max-width: 350px; max-height: 350px;">
                <div class="selfie-caption">Channing Court at 7 AM</div>
            </div>
            <div class="selfie-item">
                <img src="part_a3/channing_court_nnwarp.jpg" alt="channing_court_nearest_neighbor" style="max-width: 350px; max-height: 350px;">
                <div class="selfie-caption">Warped Channing Court (Nearest Neighbor)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a3/channing_court_blwarp.jpg" alt="channing_court_bilinear_interpolation" style="max-width: 350px; max-height: 350px;">
                <div class="selfie-caption">Warped Channing Court (Bilinear Interpolation)</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a3/roomates.jpg" alt="roomates" style="max-width: 350px; max-height: 350px;">
                <div class="selfie-caption">Roomates</div>
            </div>
            <div class="selfie-item">
                <img src="part_a3/roomates_nnwarp.jpg" alt="roomates_nearest_neighbor" style="max-width: 350px; max-height: 350px;">
                <div class="selfie-caption">Warped Roomates (Nearest Neighbor)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a3/roomates_blwarp.jpg" alt="roomates_bilinear_interpolation" style="max-width: 350px; max-height: 350px;">
                <div class="selfie-caption">Warped Roomates (Bilinear Interpolation)</div>
            </div>
        </div>
        <p style="text-align: justify;">What? Lines in a tennis court are not straight? That is probably because of the distortion with the camera in the original image.</p>
        <p style="text-align: justify;">Note that the nearest neighbor warping results in more artifacts than the bilinear interpolation method, an example can be found at the top of the warped channing court image.</p>

    </div>
    
    <div class="part part2">
        <h2>Part A.4:Blend the Images into a Mosaic</h2>
        <p style="text-align: justify;">This part of the project blends the images into a mosaic. The procedure is simple:</p>
        <ol>
            <li>Manually pick correspondences between the images</li>
            <li>Pad the images with thick black borders so that we can have better view of the whole stitched image</li>
            <li>Use the picked points to recover a homography matrix</li>
            <li>Warp the images to the same plane</li>
            <li>Add a mask used for blending</li>
            <li>Blend the images into a mosaic using a weighted average calculated with the mask. To be more specific, I take the average of the images where the masks overlap with each other.</li>
        </ol>
        <p style="text-align: justify;">Below are some examples of the stitched images. The first set of images will be used as an example to demonstrate the procedure, and the intermediate results for the other two sets of images will not be shown here for brevity.</p>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a4/lecture_1_correspondence.jpg" alt="lecture_1_correspondence" style="width: 250px; height: 200px; object-fit: cover;">
                <div class="selfie-caption">During Lecture (left) Correspondences</div>
            </div>
            <div class="selfie-item">
                <img src="part_a4/lecture_2_correspondence.jpg" alt="lecture_2_correspondence" style="width: 250px; height: 200px; object-fit: cover;">
                <div class="selfie-caption">During Lecture (middle) Correspondences</div>
            </div>
            <div class="selfie-item">
                <img src="part_a4/lecture_2_for_3_correspondence.jpg" alt="lecture_2_for_3_correspondence" style="width: 250px; height: 200px; object-fit: cover;">
                <div class="selfie-caption">During Lecture (middle for right) Correspondences</div>
            </div>
            <div class="selfie-item">
                <img src="part_a4/lecture_3_correspondence.jpg" alt="lecture_3_correspondence" style="width: 250px; height: 200px; object-fit: cover;">
                <div class="selfie-caption">During Lecture (right) Correspondences</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a4/warpped_lec_1.jpg" alt="warped_lec_1" style="width: 750px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">Warped Lecture (left)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a4/mask_1.jpg" alt="mask_lec_1" style="width: 750px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">Mask for Lecture (left)</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a4/warpped_lec_2.jpg" alt="warped_lec_2" style="width: 750px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">Warped Lecture (middle)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a4/mask_3.jpg" alt="mask_lec_2" style="width: 750px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">Mask for Lecture (middle)</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a4/warpped_lec_3.jpg" alt="warped_lec_3" style="width: 750px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">Warped Lecture (right)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a4/mask_2.jpg" alt="mask_lec_3" style="width: 750px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">Mask for Lecture (right)</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a4/during_lecture.jpg" alt="during_lecture" style="max-width: 100%; height: auto;">
                <div class="selfie-caption">During Lecture</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a1/soda_1.jpg" alt="soda_1" style="width: 300px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Outside Soda (left)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a1/soda_2.jpg" alt="soda_2" style="width: 300px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Outside Soda (middle)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a1/soda_3.jpg" alt="soda_3" style="width: 300px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Outside Soda (right)</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a4/outside_soda.jpg" alt="outside_soda" style="max-width: 100%; height: auto;">
                <div class="selfie-caption">Outside Soda</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a1/sky_1.jpg" alt="sky_1" style="width: 300px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Inside Sky Lab (left)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a1/sky_2.jpg" alt="sky_2" style="width: 300px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Inside Sky Lab (middle)</div>
            </div>
            <div class="selfie-item">
                <img src="part_a1/sky_3.jpg" alt="sky_3" style="width: 300px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Inside Sky Lab (right)</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a4/inside_sky.jpg" alt="inside_sky_lab" style="max-width: 100%; height: auto;">
                <div class="selfie-caption">Inside Sky Lab</div>
            </div>
        </div>
    </div>

    <div class="part part2">
        <h2>Part B.1: Harris Corner Detection</h2>
        <p style="text-align: justify;">In this section, I use the Harris corner detection algorithm to detect the corners of the images. However, naively choosing the strongest corners will lead to a uneven distribution of the features. Therefore, I applied Adaptive Non-Maximal Suppression (ANMS) to choose the corners. The following images are the results of the Harris corner detection and the Adaptive Non-Maximal Suppression.</p>
        <p style="text-align: justify;">ANMS is implemented by the following steps:</p>
        <ol>
            <li>Detect the corners of the image using the Harris corner detection algorithm and sort the corners by the Harris response score</li>
            <li>Maintain a list of already selected corners, initialized as empty</li>
            <li>for the i-th corner, calculate the minimum distance to the already selected corners with a response score threshold of 0.9</li>
            <li>Sort the corners by the minimum distance and select the top k corners</li>
        </ol>
        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_b1/lecture_1_harris_corners.png" alt="lecture_1_harris_corners" style="width: 350px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Lecture 1 with all corners detected by Harris corner detection</div>
            </div>
            <div class="selfie-item">
                <img src="part_b1/lecture_1_strongest_500_harris_corners.png" alt="lecture_1_strongest_500_harris_corners" style="width: 350px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Lecture 1 with 500 strongest corners</div>
            </div>
            <div class="selfie-item">
                <img src="part_b1/lecture_1_ANMS_500_harris_corners.png" alt="lecture_1_ANMS_500_harris_corners" style="width: 350px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Lecture 1 with 500 corners selected by ANMS</div>
            </div>
        </div>
    </div>

    <div class="part part2">
        <h2>Part B.2: Feature Descriptor Extraction</h2>
        <p style="text-align: justify;">This part of the project implements the feature descriptor extraction. The feature descriptor is a 8 by 8 square patch, downsampled from a 40 by 40 patch on the original scale. All the descriptors here are axis-aligned since no rotation is involved in taking the pictures. The following images are some examples of the feature descriptors from the left lecture image.</p>
        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_b2/lecture_1_descriptor_patch_0.png" alt="lecture_1_descriptor_patch_0" style="width: 350px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Lecture Descriptor Patch Example 1</div>
            </div>
            <div class="selfie-item">
                <img src="part_b2/lecture_1_descriptor_patch_1.png" alt="lecture_1_descriptor_patch_1" style="width: 350px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Lecture Descriptor Patch Example 2</div>
            </div>
            <div class="selfie-item">
                <img src="part_b2/lecture_1_descriptor_patch_2.png" alt="lecture_1_descriptor_patch_2" style="width: 350px; height: 300px; object-fit: cover;">
                <div class="selfie-caption">Lecture Descriptor Patch Example 3</div>
            </div>
        </div>
    </div>

    <div class="part part2">
        <h2>Part B.3: Feature Matching</h2>
        <p style="text-align: justify;">This part of the project implements the feature matching process. The feature matching is done by iterating through all the feature descriptors; for each descriptor, track the ratio between the errors of the best and the second best match. If the ratio is less than 0.7, then we consider it as a good match.</p>
        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_b3/lecture_1_2_matches.png" alt="lecture_1_2_matches" style="width: 900px !important; max-width: none !important; height: auto;">
                <div class="selfie-caption">Lecture Matches</div>
            </div>
        </div>
    </div>

    <div class="part part2">
        <h2>Part B.4: RANSAC for Robust Homography</h2>
        <p style="text-align: justify;">This part of the project implements the RANSAC algorithm to robustly estimate the homography matrix. The RANSAC algorithm is implemented by the following steps:</p>
        <ol>
            <li>Randomly sample 4 points from the matches</li>
            <li>Estimate the homography matrix using the 4 points</li>
            <li>Count the number of inliers</li>
            <li>Repeat the process for a certain number of iterations</li>
            <li>With the most inliers, estimate the homography matrix with all the inliers</li>
            <li>Return the homography matrix</li>
        </ol>
        <p style="text-align: justify;">The following images are some examples of the auto-stitched images and a comparison between the stitching with manually picked correspondences.</p>
        
        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a4/during_lecture.jpg" alt="" style="width: 800px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">During Lecture (Stitched Manually)</div>
            </div>
            <div class="selfie-item">
                <img src="part_b4/during_lecture_auto.jpg" alt="" style="width: 800px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">During Lecture (Stitched with RANSAC)</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a4/outside_soda.jpg" alt="" style="width: 800px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">Outside Soda (Stitched Manually)</div>
            </div>
            <div class="selfie-item">
                <img src="part_b4/outside_soda_auto.jpg" alt="" style="width: 800px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">Outside Soda (Stitched with RANSAC)</div>
            </div>
        </div>

        <div class="selfie-row">
            <div class="selfie-item">
                <img src="part_a4/inside_sky.jpg" alt="" style="width: 800px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">Inside Sky Lab (Stitched Manually)</div>
            </div>
            <div class="selfie-item">
                <img src="part_b4/inside_sky_auto.jpg" alt="" style="width: 800px; height: 280px; object-fit: cover;">
                <div class="selfie-caption">Inside Sky Lab (Stitched with RANSAC)</div>
            </div>
        </div>


    </div>

</body>
</html>

